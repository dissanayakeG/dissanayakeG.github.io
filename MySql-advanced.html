<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>MySql-advanced</title>
  <style>
html {
color: #1a1a1a;
background-color: #fdfdfd;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
overflow-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 12px;
}
h1 {
font-size: 1.8em;
}
}
@media print {
html {
background-color: white;
}
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: #1a1a1a;
}
a:visited {
color: #1a1a1a;
}
img {
max-width: 100%;
}
svg {
height: auto;
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1.4em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
background-color: #1a1a1a;
border: none;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid #1a1a1a;
border-bottom: 1px solid #1a1a1a;
}
th {
border-top: 1px solid #1a1a1a;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC ul {
padding-left: 1.3em;
}
#TOC > ul {
padding-left: 0;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}

pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
</head>
<body>
<section id="stored-procedures" class="level1">
<h1>Stored procedures</h1>
<section id="basic-mysql-stored-procedures" class="level2">
<h2>Basic MySQL Stored procedures</h2>
<ul>
<li>A stored procedure is a wrapper of a set of SQL statements stored in the MySQL database server.</li>
<li>If you invoke the same stored procedure again within the same session, MySQL will execute it from the cache without the need for recompilation.</li>
<li>The advantages of stored procedures include reduced network traffic, enhanced code reusability, improved security through controlled access, streamlined implementation of business logic, and the ability to grant specific privileges to applications without exposing underlying database structures.</li>
<li>The disadvantages of stored procedures include increased memory usage for each connection, challenges in debugging due to a lack of dedicated tools, and the necessity for a specialized skill set, which not all application developers may possess, leading to potential difficulties in both development and maintenance processes.</li>
<li>default delimiter (;) uses to separate statements and execute each separately.</li>
<li>Since a SP consist of multiple statements, mysql client need a different delimiter in order to treat the entire stored procedure as a single statement.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>DELIMITER <span class="op">//</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> sp_name(parameter_list)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>   statements;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="op">//</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span></code></pre></div>
<section id="sp-parameter-types" class="level3">
<h3>SP Parameter types</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>[<span class="kw">IN</span> | <span class="kw">OUT</span> | INOUT] parameter_name datatype[(<span class="fu">length</span>)]</span></code></pre></div>
<ol type="1">
<li>IN : default | calling program must pass an argument | protected, changing value within SP does not change original value, work with a copy of the value.</li>
<li>OUT : can be modified | updated value is then passed back to the calling program | cannot access the initial value of the OUT parameter when they begin.</li>
<li>INOUT : calling program may pass the argument | can modify | pass the new value back to the calling program.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>#pass a <span class="kw">session</span> variable ( @total ) <span class="kw">to</span> receive <span class="kw">the</span> <span class="kw">return</span> <span class="fu">value</span>.</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CALL</span> GetOrderCountByStatus(<span class="st">&#39;Shipped&#39;</span>,@total); #<span class="dv">1</span>st <span class="kw">IN</span> <span class="dv">2</span>nd <span class="kw">OUT</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @total;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>#INOUT</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>DELIMITER $$</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> SetCounter(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    INOUT counter <span class="dt">INT</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IN</span> inc <span class="dt">INT</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SET</span> counter <span class="op">=</span> counter <span class="op">+</span> inc;</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>END$$</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @counter <span class="op">=</span> <span class="dv">1</span>;</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">CALL</span> SetCounter(@counter,<span class="dv">1</span>); <span class="co">-- 2</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="kw">CALL</span> SetCounter(@counter,<span class="dv">1</span>); <span class="co">-- 3</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="kw">CALL</span> SetCounter(@counter,<span class="dv">5</span>); <span class="co">-- 8</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @counter; <span class="co">-- 8</span></span></code></pre></div>
</section>
<section id="variables" class="level3">
<h3>Variables</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> variable_name datatype(<span class="kw">size</span>) [<span class="kw">DEFAULT</span> default_value];</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> totalSale <span class="dt">DEC</span>(<span class="dv">10</span>,<span class="dv">2</span>) <span class="kw">DEFAULT</span> <span class="fl">0.0</span>;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>#Assigning variables</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> variable_name <span class="op">=</span> <span class="fu">value</span>;</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">INTO</span> productCount <span class="kw">FROM</span> products;</span></code></pre></div>
<ul>
<li>A variable whose name begins with the @ sign is a session variable, available and accessible until the session ends.</li>
</ul>
</section>
<section id="listing-stored-procedures" class="level3">
<h3>Listing Stored Procedures</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">PROCEDURE</span> STATUS [<span class="kw">LIKE</span> <span class="st">&#39;pattern&#39;</span> | <span class="kw">WHERE</span> search_condition]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">PROCEDURE</span> STATUS;</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">PROCEDURE</span> STATUS <span class="kw">WHERE</span> db <span class="op">=</span> <span class="st">&#39;classicmodels&#39;</span>;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">PROCEDURE</span> STATUS <span class="kw">LIKE</span> <span class="st">&#39;%Order%&#39;</span></span></code></pre></div>
</section>
</section>
<section id="conditional-statements" class="level2">
<h2>Conditional Statements</h2>
<ul>
<li>IF statement is different tahat IF() function.</li>
<li>IF…THEN | IF…THEN…ELSE | IF…THEN…ELSEIF…ELSE</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>DELIMITER $$</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> GetCustomerLevel(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IN</span>  pCustomerNumber <span class="dt">INT</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">OUT</span> pCustomerLevel  <span class="dt">VARCHAR</span>(<span class="dv">20</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DECLARE</span> credit <span class="dt">DECIMAL</span>(<span class="dv">10</span>,<span class="dv">2</span>) <span class="kw">DEFAULT</span> <span class="dv">0</span>;</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> creditLimit </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INTO</span> credit</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> customers</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> customerNumber <span class="op">=</span> pCustomerNumber;</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">IF</span> credit <span class="op">&gt;</span> <span class="dv">50000</span> <span class="cf">THEN</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> pCustomerLevel <span class="op">=</span> <span class="st">&#39;PLATINUM&#39;</span>;</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    ELSEIF credit <span class="op">&lt;=</span> <span class="dv">50000</span> <span class="kw">AND</span> credit <span class="op">&gt;</span> <span class="dv">10000</span> <span class="cf">THEN</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> pCustomerLevel <span class="op">=</span> <span class="st">&#39;GOLD&#39;</span>;</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">ELSE</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> pCustomerLevel <span class="op">=</span> <span class="st">&#39;SILVER&#39;</span>;</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">IF</span>;</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>END$$</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">CALL</span> GetCustomerLevel(<span class="dv">141</span>, @level);</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @level; #PLATINUM</span></code></pre></div>
<ul>
<li>CASE expression if differs from the CASE statement.</li>
<li>Simple CASE statement |Searched CASE statement.</li>
</ul>
<section id="simple-case-statement" class="level3">
<h3>Simple CASE statement</h3>
<ul>
<li>To avoid the error when the case_value does not equal any when_value, you can use an empty BEGIN…END block in the ELSE clause.</li>
<li>The simple CASE statement tests for equality ( =), therefore, you cannot use it to test equality with NULL because NULL = NULL returns FALSE.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">CASE</span> case_value</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> when_value1 <span class="cf">THEN</span> <span class="op">..</span>.</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> when_value2 <span class="cf">THEN</span> <span class="op">..</span>.</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">ELSE</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">BEGIN</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">END</span>;</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="cf">CASE</span>;</span></code></pre></div>
</section>
<section id="searched-case-statement" class="level3">
<h3>Searched CASE statement</h3>
<ul>
<li>Use a simple CASE statement to evaluate a specific expression against a series of possible values and execute corresponding actions.</li>
<li>Use a searched CASE statement to evaluate various conditions individually, allowing for a more flexible code.</li>
</ul>
</section>
</section>
<section id="loops" class="level2">
<h2>Loops</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>#LOOP</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>[<span class="kw">label</span>]: <span class="cf">LOOP</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">IF</span> condition <span class="cf">THEN</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        LEAVE [<span class="kw">label</span>]; <span class="op">//</span><span class="kw">The</span> <span class="cf">loop</span> exits <span class="cf">when</span> <span class="kw">the</span> LEAVE statement <span class="kw">is</span> reached.</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        #ITERATE [<span class="kw">label</span>]; <span class="op">//</span><span class="kw">to</span> <span class="kw">skip</span> <span class="kw">the</span> <span class="kw">current</span> iteration</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">IF</span>;</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="cf">LOOP</span>;</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>#WHILE</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>[begin_label:] <span class="cf">WHILE</span> search_condition DO</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    statement_list</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="cf">WHILE</span> [end_label]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a># REPEAT</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>[begin_label:] REPEAT</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    statement;</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">UNTIL</span> condition</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> REPEAT [end_label]</span></code></pre></div>
<ul>
<li>It’s important to note that the REPEAT checks the condition after the execution of the block, meaning that the block always executes at least once.</li>
<li>The LEAVE statement exits the flow control that has a given label.</li>
<li>Use the MySQL LEAVE statement to exit a stored procedure or terminate a loop.</li>
</ul>
</section>
<section id="error-handling" class="level2">
<h2>Error Handling</h2>
<section id="show-warnings" class="level3">
<h3>Show Warnings</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>SHOW WARNINGS;</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>SHOW WARNINGS [<span class="kw">LIMIT</span> [offset,] row_count] <span class="co">--&gt; SHOW WARNINGS LIMIT 2;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>SHOW <span class="fu">COUNT</span>(<span class="op">*</span>) WARNINGS;</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @@warning_count; #system variable:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>SHOW VARIABLES <span class="kw">LIKE</span> <span class="st">&#39;max_error_count&#39;</span>;</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> max_error_count<span class="op">=</span><span class="dv">2048</span>;</span></code></pre></div>
<ul>
<li>MySQL uses the max_error_count system variable to control the maximum number of warnings, errors, and notes that the server can store.</li>
</ul>
</section>
<section id="show-errors" class="level3">
<h3>Show ERRORS</h3>
<ul>
<li>The SHOW ERRORS statement is used to display error information about the most recent execution of a statement or a stored procedure.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>SHOW ERRORS;</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>SHOW ERRORS [<span class="kw">LIMIT</span> [offset,] row_count];</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>SHOW <span class="fu">COUNT</span>(<span class="op">*</span>) ERRORS;</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> @@error_count; # <span class="kw">system</span> variable</span></code></pre></div>
</section>
<section id="declare-handler" class="level3">
<h3>DECLARE … HANDLER</h3>
<ul>
<li>Use MySQL handlers to handle conditions including warnings and errors in stored procedures.</li>
<li>Use the DECLARE…HANDLER statement to declare a handler.</li>
<li>SQLSTATE is a five-character that provides information about the result of an SQL operation.
<ul>
<li>An SQLSTATE consists of two parts:</li>
</ul>
<ol type="1">
<li>Class Code (First two characters): Indicates the general category of the error.</li>
<li>Subclass Code (Next three characters): Provides more specific information about the error within the general category.</li>
</ol></li>
<li>For example, a SQLSTATE code of ’42S02′ indicates a missing table, where ’42’ is the class code for syntax error or access rule violation, and ‘S02’ is the subclass code indicating that the table is not found.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> { EXIT | <span class="kw">CONTINUE</span> } HANDLER</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">FOR</span> condition_value [, condition_value] <span class="op">..</span>.</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    statement</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>#Example</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>DELIMITER <span class="op">//</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> insert_user(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IN</span> p_username <span class="dt">VARCHAR</span>(<span class="dv">50</span>), </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IN</span> p_email <span class="dt">VARCHAR</span>(<span class="dv">50</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- SQLSTATE for unique constraint violation</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DECLARE</span> EXIT HANDLER <span class="cf">FOR</span> SQLSTATE <span class="st">&#39;23000&#39;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">BEGIN</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Handler actions when a duplicate username is detected</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="st">&#39;Error: Duplicate username. Please choose a different username.&#39;</span> <span class="kw">AS</span> Message;</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">END</span>;</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Attempt to insert the user into the table</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">INSERT</span> <span class="kw">INTO</span> users (username, email) <span class="kw">VALUES</span> (p_username, p_email);</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- If the insertion was successful, display a success message</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="st">&#39;User inserted successfully&#39;</span> <span class="kw">AS</span> Message;</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="op">//</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>#call</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="kw">CALL</span> insert_user(<span class="st">&#39;jane&#39;</span>,<span class="st">&#39;jane@example.com&#39;</span>);</span></code></pre></div>
</section>
<section id="declare-condition" class="level3">
<h3>DECLARE … CONDITION</h3>
<ul>
<li>Use MySQL DECLARE … CONDITION to associate a name with a condition specified by a MySQL error code or SQLSTATE value to make the stored procedure code more readable and expressive.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> unknown_table CONDITION <span class="cf">FOR</span> <span class="dv">1051</span>;</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span> <span class="kw">CONTINUE</span> HANDLER <span class="cf">FOR</span> unknown_table </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">BEGIN</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- body of handler</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">END</span>;</span></code></pre></div>
</section>
<section id="signals" class="level3">
<h3>SIGNALs</h3>
<ul>
<li>The MySQL SIGNAL statement allows you to raise an exception within a stored program, including a stored procedure, a stored function, a trigger, or an event.</li>
<li>condition_value can be An SQLSTATE valu or A named condition is defined with DECLARE … CONDITION statement.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>DELIMITER <span class="op">//</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> update_salary(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IN</span> p_employee_id <span class="dt">INT</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IN</span> p_salary <span class="dt">DECIMAL</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DECLARE</span> employee_count <span class="dt">INT</span>;</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- check if employee exists</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">INTO</span> employee_count </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> employees</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> p_employee_id;</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">IF</span> employee_count <span class="op">=</span> <span class="dv">0</span> <span class="cf">THEN</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        SIGNAL SQLSTATE <span class="st">&#39;45000&#39;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> MESSAGE_TEXT <span class="op">=</span> <span class="st">&#39;Employee not found&#39;</span>;</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">IF</span>;</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- validate salary</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">IF</span> p_salary <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">THEN</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        SIGNAL SQLSTATE <span class="st">&#39;45000&#39;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> MESSAGE_TEXT <span class="op">=</span> <span class="st">&#39;Salary cannot be negative&#39;</span>;</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">IF</span>;</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- if every is fine, update the salary</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UPDATE</span> employees</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SET</span> salary <span class="op">=</span> p_salary</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> p_employee_id;    </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="op">//</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span></code></pre></div>
</section>
<section id="resignal" class="level3">
<h3>RESIGNAL</h3>
<ul>
<li>Use the RESIGNAL statement to re-raise an exception.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>#<span class="dv">1</span>) <span class="kw">Using</span> MySQL RESIGNAL <span class="kw">to</span> re<span class="op">-</span>raise <span class="kw">the</span> same <span class="kw">exception</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>DELIMITER <span class="op">//</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> DropTableXYZ()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- reraise the error</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DECLARE</span> EXIT HANDLER <span class="cf">FOR</span> SQLEXCEPTION</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">BEGIN</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    RESIGNAL;</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">END</span>;</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- drop a table that doesn&#39;t exist</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DROP</span> <span class="kw">TABLE</span> XYZ;</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span><span class="op">//</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">-- ERROR 1051 (42S02): Unknown table &#39;classicmodels.xyz&#39;</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>#<span class="dv">2</span>) <span class="kw">Using</span> RESIGNAL statement <span class="kw">with</span> <span class="kw">new</span> signal information    </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- reraise the error</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DECLARE</span> EXIT HANDLER <span class="cf">FOR</span> SQLEXCEPTION</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">BEGIN</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    RESIGNAL <span class="kw">SET</span> MYSQL_ERRNO <span class="op">=</span> <span class="dv">5</span>;</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">END</span>;</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- drop a table that doesn&#39;t exist</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DROP</span> <span class="kw">TABLE</span> XYZ;</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span><span class="op">//</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">-- ERROR 5 (42S02): Unknown table &#39;classicmodels.xyz&#39;</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>#<span class="dv">3</span>) Re<span class="op">-</span>rasing <span class="kw">exception</span> <span class="kw">with</span> <span class="kw">new</span> condition <span class="fu">value</span> <span class="kw">and</span> signal information:</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- reraise the error</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DECLARE</span> EXIT HANDLER <span class="cf">FOR</span> SQLEXCEPTION</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">BEGIN</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    RESIGNAL SQLSTATE <span class="st">&#39;45000&#39;</span> <span class="kw">SET</span> MYSQL_ERRNO <span class="op">=</span> <span class="dv">5</span>;</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">END</span>;</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- drop a table that doesn&#39;t exist</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DROP</span> <span class="kw">TABLE</span> XYZ;</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span><span class="op">//</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co">-- ERROR 5 (45000): Unknown table &#39;classicmodels.xyz&#39;</span></span></code></pre></div>
</section>
</section>
<section id="cursor" class="level2">
<h2>Cursor</h2>
<ul>
<li>Cursors are used in stored procedures to iterate through a result set returned by a SELECT statement.</li>
<li>Cursors are used to process a result set row by row individually.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>DELIMITER $$</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> create_email_list (</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    INOUT email_list TEXT</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DECLARE</span> done BOOL <span class="kw">DEFAULT</span> <span class="kw">false</span>;</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DECLARE</span> email_address <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">DEFAULT</span> <span class="ot">&quot;&quot;</span>;</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- declare cursor for employee email</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DECLARE</span> cur <span class="kw">CURSOR</span> <span class="cf">FOR</span> <span class="kw">SELECT</span> email <span class="kw">FROM</span> employees;</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- declare NOT FOUND handler</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DECLARE</span> <span class="kw">CONTINUE</span> HANDLER </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">FOR</span> <span class="kw">NOT</span> FOUND <span class="kw">SET</span> done <span class="op">=</span> <span class="kw">true</span>;</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- open the cursor</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">OPEN</span> cur;</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SET</span> email_list <span class="op">=</span> <span class="st">&#39;&#39;</span>;</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    process_email: <span class="cf">LOOP</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        FETCH cur <span class="kw">INTO</span> email_address;</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">IF</span> done <span class="op">=</span> <span class="kw">true</span> <span class="cf">THEN</span> </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>            LEAVE process_email;</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">END</span> <span class="cf">IF</span>;</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">-- concatenate the email into the emailList</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> email_list <span class="op">=</span> <span class="fu">CONCAT</span>(email_address,<span class="ot">&quot;;&quot;</span>,email_list);</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">LOOP</span>;</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- close the cursor</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CLOSE</span> cur;</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>END$$</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span></code></pre></div>
<section id="prepared-statement" class="level3">
<h3>Prepared Statement</h3>
<ul>
<li>helps you enhance the security and performance of database queries.</li>
<li>Prepared statements allow you to write SQL queries with placeholders for parameters, and then bind values to those parameters at runtime. They can help prevent SQL injection attacks and optimize query execution.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">PREPARE</span> stmt_name <span class="kw">FROM</span> preparable_stmt;</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @var_name1 <span class="op">=</span> value1;</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @var_name2 <span class="op">=</span> value2;</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">EXECUTE</span> stmt_name [<span class="kw">USING</span> @var_name [, @var_name] <span class="op">..</span>.];</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>{<span class="kw">DEALLOCATE</span> | <span class="kw">DROP</span>} <span class="kw">PREPARE</span> stmt_name;</span></code></pre></div>
<ul>
<li>The preparable_stmt is sent to the MySQL server with placeholders (?) for parameters. Upon receiving the statement, the MySQL server parses, optimizes, and precompiles the query, and then creates the prepared statement.</li>
<li>Note : Note that you can use only user variables as the values for the parameters.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> <span class="dt">INT</span> AUTO_INCREMENT <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    username <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">UNIQUE</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    email <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">UNIQUE</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="kw">PREPARE</span> insert_user <span class="kw">FROM</span> <span class="st">&#39;INSERT INTO users (username, email) VALUES (?, ?)&#39;</span>;</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @username <span class="op">=</span> <span class="st">&#39;john_doe&#39;</span>;</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @email <span class="op">=</span> <span class="st">&#39;jone@example.com&#39;</span>;</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="kw">EXECUTE</span> insert_user <span class="kw">USING</span> @username, @email;</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>#reuse, This <span class="dt">time</span>, MySQL will <span class="kw">use</span> <span class="kw">the</span> precompiled statement:</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @username <span class="op">=</span> <span class="st">&#39;jane_doe&#39;</span>;</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> @email <span class="op">=</span> <span class="st">&#39;jane@example.com&#39;</span>;</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="kw">EXECUTE</span> insert_user <span class="kw">USING</span> @username, @email;</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="kw">DEALLOCATE</span> <span class="kw">PREPARE</span> insert_user;</span></code></pre></div>
</section>
</section>
<section id="stored-functions" class="level2">
<h2>Stored Functions</h2>
<ul>
<li>A stored function is a specialized type of stored program designed to return a single value. Typically, you use stored functions to encapsulate common formulas or business rules, making them reusable across SQL statements or other stored programs.</li>
<li>Unlike a stored procedure, you can use a stored function in SQL statements wherever you use an expression.</li>
<li>By default, stored functions consider all parameters as IN parameters. You cannot specify IN , OUT or INOUT modifiers to parameters</li>
<li>A deterministic function always returns the same result for the same input parameters, while a non-deterministic function produces different results for the same input parameters.</li>
<li>Inside the body section, you need to include at least one RETURN statement. The RETURN statement sends a value to the calling programs.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>DELIMITER $$</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">FUNCTION</span> CustomerLevel(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    credit <span class="dt">DECIMAL</span>(<span class="dv">10</span>,<span class="dv">2</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>RETURNS <span class="dt">VARCHAR</span>(<span class="dv">20</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>DETERMINISTIC</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DECLARE</span> customerLevel <span class="dt">VARCHAR</span>(<span class="dv">20</span>);</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">IF</span> credit <span class="op">&gt;</span> <span class="dv">50000</span> <span class="cf">THEN</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> customerLevel <span class="op">=</span> <span class="st">&#39;PLATINUM&#39;</span>;</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    ELSEIF (credit <span class="op">&gt;=</span> <span class="dv">50000</span> <span class="kw">AND</span> </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            credit <span class="op">&lt;=</span> <span class="dv">10000</span>) <span class="cf">THEN</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> customerLevel <span class="op">=</span> <span class="st">&#39;GOLD&#39;</span>;</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    ELSEIF credit <span class="op">&lt;</span> <span class="dv">10000</span> <span class="cf">THEN</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SET</span> customerLevel <span class="op">=</span> <span class="st">&#39;SILVER&#39;</span>;</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">IF</span>;</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- return the customer level</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">RETURN</span> (customerLevel);</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>END$$</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FUNCTION</span> STATUS <span class="kw">WHERE</span> db <span class="op">=</span> <span class="st">&#39;classicmodels&#39;</span>;</span></code></pre></div>
<ul>
<li>It’s important to notice that if a stored function contains SQL statements that retrieve data from tables, then you should avoid using it in other SQL statements; otherwise, the stored function may slow down the query speed.</li>
<li>stored functions can be called from select statements, stored procedures…ect EX)</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> customerName, CustomerLevel(creditLimit)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> customers <span class="kw">ORDER</span> <span class="kw">BY</span> customerName;</span></code></pre></div>
<section id="drop-function" class="level3">
<h3>DROP FUNCTION</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">FUNCTION</span> [<span class="cf">IF</span> <span class="kw">EXISTS</span>] function_name;</span></code></pre></div>
</section>
<section id="listing-stored-functions" class="level3">
<h3>Listing Stored Functions</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FUNCTION</span> STATUS [<span class="kw">LIKE</span> <span class="st">&#39;pattern&#39;</span> | <span class="kw">WHERE</span> search_condition];</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FUNCTION</span> STATUS; # shows <span class="kw">all</span> stored <span class="kw">functions</span> <span class="kw">in</span> <span class="kw">the</span> <span class="kw">current</span> MySQL server</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FUNCTION</span> STATUS <span class="kw">WHERE</span> db <span class="op">=</span> <span class="st">&#39;classicmodels&#39;</span>;</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FUNCTION</span> STATUS <span class="kw">LIKE</span> <span class="st">&#39;%pattern%&#39;</span>;</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>#Note that <span class="kw">the</span> SHOW <span class="kw">FUNCTION</span> STATUS <span class="kw">only</span> shows <span class="kw">the</span> <span class="kw">function</span> that you have a <span class="kw">privilege</span> <span class="kw">to</span> <span class="kw">access</span>.</span></code></pre></div>
</section>
</section>
<section id="stored-program-security" class="level2">
<h2>Stored Program Security</h2>
<ul>
<li><p>In MySQL, stored programs including stored procedures stored functions, triggers, and events execute within a security context which determines their privileges.</p></li>
<li><p>MySQL uses DEFINER and SQL SECURITY characteristics to control these privileges.</p></li>
</ul>
</section>
<section id="transactions" class="level2">
<h2>Transactions</h2>
<ul>
<li>A transaction is a sequence of one or more SQL statements that are executed as a single unit of work.</li>
<li>By default, when you execute an SQL statement, MySQL automatically wraps it in a transaction and commits the transaction automatically.</li>
<li>To instruct MySQL to not start a transaction implicitly and commit the changes automatically, you set the value of the autocommit variable to 0 or OFF:</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> autocommit <span class="op">=</span> <span class="kw">OFF</span>; #or</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> autocommit <span class="op">=</span> <span class="dv">0</span>;</span></code></pre></div>
<ul>
<li>To enable the auto-commit mode, you set the value of the autocommit variable to 1 or ON:</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> autocommit <span class="op">=</span> <span class="dv">1</span>; #or</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> autocommit <span class="op">=</span> <span class="kw">ON</span>;</span></code></pre></div>
<ul>
<li>Use the START TRANSACTION statement to start a transaction.</li>
<li>Use the COMMIT statement to apply the changes made during the transaction to the database.</li>
<li>Use the ROLLBACK statement to roll back the changes made during the transaction and revert the state of the database before the transaction starts.</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">DATABASE</span> banks;</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> banks;</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> <span class="dt">INT</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    username <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    email <span class="dt">VARCHAR</span>(<span class="dv">255</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="kw">START</span> <span class="kw">TRANSACTION</span>;</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> users (<span class="kw">id</span>, username) </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="st">&#39;john&#39;</span>);</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> users </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> email <span class="op">=</span> <span class="st">&#39;john.doe@example.com&#39;</span> </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> <span class="dv">1</span>;</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a># <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> users; shows <span class="kw">the</span> inserted <span class="kw">data</span> <span class="kw">only</span> <span class="cf">for</span> <span class="kw">current</span> <span class="kw">session</span> since it didn<span class="st">&#39;t commit yet</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="st">COMMIT;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="st"># ROLLBACK; - undoes all the changes made during the transaction, reverting the database to its state before the transaction started</span></span></code></pre></div>
<ul>
<li>transactions can be used in Stored Procedures for more advance transactions (<a href="#https://www.mysqltutorial.org/mysql-stored-procedure/mysql-transactions/">See</a>)</li>
</ul>
</section>
</section>
<section id="triggers" class="level1">
<h1>Triggers</h1>
<ul>
<li>A trigger is a stored program invoked automatically in response to an event such as insert, update, or delete that occurs in the associated table</li>
<li>The SQL standard defines two types of triggers: row-level triggers and statement-level triggers.</li>
<li>MySQL supports only row-level triggers.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>DELIMITER <span class="op">//</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> trigger_name</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>{<span class="kw">BEFORE</span> | <span class="kw">AFTER</span>} {<span class="kw">INSERT</span> | <span class="kw">UPDATE</span> | <span class="kw">DELETE</span>}</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> table_name</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Trigger body (SQL statements)</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span>;</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="op">//</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span></code></pre></div>
<ul>
<li>If you have multiple statements in the trigger_body, you have to use the BEGIN END block and change the default delimiter.</li>
<li>The trigger body can access the values of the column being affected by the operation.</li>
<li>To distinguish between the value of the columns BEFORE and AFTER the event has fired, you use the NEW and OLD modifiers. Ex: OLD.description, NEW.description</li>
<li>No OLD BEFORE INSERT and no NEW value AFTER DELETE</li>
<li>In an AFTER INSERT trigger, you can access the NEW values but you cannot change them.</li>
<li>In a BEFORE UPDATE trigger, you can update the NEW values but cannot update the OLD values.</li>
<li>In a AFTER UPDATE trigger, you can access OLD and NEW rows but cannot update them.</li>
<li>In a BEFORE DELETE trigger, you can access the OLD row but cannot update it.</li>
<li>In an AFTER DELETE trigger, you can access the OLD row but cannot change it.</li>
<li>The DROP TRIGGER requires the TRIGGER privilege for the table associated with the trigger.</li>
<li>Note that if you drop a table, MySQL will automatically drop all triggers associated with the table.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a># <span class="kw">to</span> <span class="kw">drop</span> a <span class="kw">trigger</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TRIGGER</span> [<span class="cf">IF</span> <span class="kw">EXISTS</span>] [schema_name.]trigger_name;</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a># <span class="kw">to</span> show</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TRIGGERS</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>[{<span class="kw">FROM</span> | <span class="kw">IN</span>} database_name]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>[<span class="kw">LIKE</span> <span class="st">&#39;pattern&#39;</span> | <span class="kw">WHERE</span> search_condition];</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TRIGGERS</span> <span class="kw">FROM</span> database_name <span class="kw">LIKE</span> <span class="st">&#39;pattern&#39;</span>; # similar <span class="kw">to</span> SHOW <span class="kw">TRIGGERS</span> <span class="kw">IN</span> database_name <span class="kw">LIKE</span> <span class="st">&#39;pattern&#39;</span>;</span></code></pre></div>
<ul>
<li>Notice that to execute the SHOW TRIGGERS statement, you need to have the SUPER privilege.</li>
<li>Below is the Syntax for defining a trigger that will activate before or after an existing trigger in response to the same event and action time:</li>
<li>Only for MySQL 5.7.2+</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>DELIMITER $$</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> trigger_name</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>{<span class="kw">BEFORE</span>|<span class="kw">AFTER</span>}{<span class="kw">INSERT</span>|<span class="kw">UPDATE</span>|<span class="kw">DELETE</span>} </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> table_name <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>{FOLLOWS|PRECEDES} existing_trigger_name</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- statements</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>END$$</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span></code></pre></div>
<section id="how-to-call-a-stored-procedure-from-a-trigger" class="level2">
<h2>How To Call a Stored Procedure From a Trigger</h2>
<ul>
<li>The following statement creates a BEFORE UPDATE trigger that calls the stored procedure CheckWithdrawal:</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>DELIMITER $$</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> before_accounts_update</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">BEFORE</span> <span class="kw">UPDATE</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> accounts <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CALL</span> CheckWithdrawal (</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">OLD</span>.accountId, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">OLD</span>.amount <span class="op">-</span> <span class="kw">NEW</span>.amount</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    );</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>END$$</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>DELIMITER ;</span></code></pre></div>
</section>
</section>
<section id="events" class="level1">
<h1>Events</h1>
<ul>
<li>MySQL events are similar to cron jobs on Linux or task schedulers on Windows, providing a tool to automate recurring tasks within the MySQL database server.</li>
</ul>
<section id="lifecycle" class="level2">
<h2>lifecycle</h2>
<ul>
<li>Creation -&gt; Activation -&gt; Modification -&gt; Deactivation -&gt; Removal</li>
<li>MySQL uses a special thread called an event scheduler thread to execute all scheduled events.</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>SHOW PROCESSLIST; #view <span class="kw">the</span> status <span class="kw">of</span> <span class="kw">the</span> event scheduler <span class="kw">thread</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> <span class="kw">GLOBAL</span> event_scheduler <span class="op">=</span> <span class="kw">ON</span>; #to <span class="kw">enable</span> <span class="kw">and</span> <span class="kw">start</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> <span class="kw">GLOBAL</span> event_scheduler <span class="op">=</span> <span class="kw">OFF</span>;</span></code></pre></div>
</section>
<section id="create-an-event" class="level2">
<h2>Create an Event</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EVENT [<span class="cf">IF</span> <span class="kw">NOT</span> EXIST] event_name</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> SCHEDULE <span class="op">&lt;</span>schedule<span class="op">&gt;</span> #this can be vary based <span class="kw">on</span> <span class="kw">the</span> schedule</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>DO</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>event_body</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>#If <span class="kw">the</span> event <span class="kw">is</span> a one<span class="op">-</span><span class="dt">time</span> event, you <span class="kw">use</span> <span class="kw">the</span> syntax:</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="kw">AT</span> <span class="dt">timestamp</span> [<span class="op">+</span> <span class="dt">INTERVAL</span>]</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>#If <span class="kw">the</span> event <span class="kw">is</span> a recurring event, you <span class="kw">use</span> <span class="kw">the</span> EVERY clause:</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>EVERY <span class="dt">interval</span> </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>STARTS <span class="dt">timestamp</span> [<span class="op">+</span><span class="dt">INTERVAL</span>] </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>ENDS <span class="dt">timestamp</span> [<span class="op">+</span><span class="dt">INTERVAL</span>]</span></code></pre></div>
<ul>
<li>If you have multiple statements, you can use the BEGIN…END block. Please note that you can call a stored procedure inside the body of an event.</li>
<li>Event are automatically dropped when it expires</li>
<li>To keep the event after it has expired, you use the ON COMPLETION PRESERVE clause.</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">EVENTS</span> <span class="kw">FROM</span> mydb; #To show <span class="kw">all</span> <span class="kw">events</span> <span class="kw">in</span> <span class="kw">the</span> mydb <span class="kw">database</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EVENT one_time_log</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> SCHEDULE <span class="kw">AT</span> <span class="fu">CURRENT_TIMESTAMP</span> <span class="op">+</span> <span class="dt">INTERVAL</span> <span class="dv">1</span> <span class="kw">MINUTE</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> COMPLETION <span class="kw">PRESERVE</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>DO</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">INSERT</span> <span class="kw">INTO</span> messages(message)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>   <span class="kw">VALUES</span>(<span class="st">&#39;Preserved One-time event&#39;</span>);</span></code></pre></div>
</section>
<section id="alter-event" class="level2">
<h2>ALTER EVENT</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> EVENT [<span class="cf">IF</span> <span class="kw">EXISTS</span>] event_name</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> SCHEDULE schedule</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>[<span class="kw">ON</span> COMPLETION [<span class="kw">NOT</span>] <span class="kw">PRESERVE</span>]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>[<span class="kw">COMMENT</span> <span class="st">&#39;comment&#39;</span>]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>[<span class="kw">ENABLE</span> | <span class="kw">DISABLE</span>]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>DO event_body</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>#Changing <span class="kw">the</span> schedule</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> EVENT test_event</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> SCHEDULE EVERY <span class="dv">2</span> <span class="kw">MINUTE</span>;</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>#Changing <span class="kw">the</span> event <span class="kw">body</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> EVENT test_event</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>DO</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>   <span class="kw">INSERT</span> <span class="kw">INTO</span> messages(message)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>   <span class="kw">VALUES</span>(<span class="st">&#39;New message&#39;</span>);</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>#Disabling an event</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> EVENT test_event</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="kw">DISABLE</span>;</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>#Enabling an event</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> EVENT test_event</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="kw">ENABLE</span>;</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>#Renaming an event</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> EVENT test_event</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="kw">RENAME</span> <span class="kw">TO</span> sample_event;</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>#Moving an event <span class="kw">to</span> another <span class="kw">database</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> EVENT mydb.sample_event</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="kw">RENAME</span> <span class="kw">TO</span> newdb.test_event;</span></code></pre></div>
</section>
<section id="drop-event" class="level2">
<h2>DROP EVENT</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> EVENT [<span class="cf">IF</span> <span class="kw">EXISTS</span>] event_name [, event_name] <span class="op">..</span>.;</span></code></pre></div>
<ul>
<li><p>Note that you can use the wildcard % in the event name to remove all the events that match a specific pattern.</p></li>
<li><p>To perform the DROP EVENT statement, you need to have EVENT privilege for the database to which the event belongs.</p></li>
</ul>
</section>
<section id="show-events" class="level2">
<h2>SHOW EVENTS</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">EVENTS</span> [<span class="kw">FROM</span> db_name] </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>[<span class="kw">LIKE</span> <span class="st">&#39;pattern&#39;</span> | <span class="kw">WHERE</span> expr];</span></code></pre></div>
</section>
</section>
<section id="views" class="level1">
<h1>Views</h1>
<ul>
<li>By definition, a view is a named query stored in the database catalog.</li>
<li>Note that a view does not physically store the data. When you issue the SELECT statement against the view, MySQL executes the underlying query specified in the view’s definition and returns the result set. For this reason, sometimes, a view is referred to as a virtual table.</li>
</ul>
<section id="create-view" class="level2">
<h2>CREATE VIEW</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> [<span class="kw">OR</span> <span class="kw">REPLACE</span>] <span class="kw">VIEW</span> [db_name.]view_name [(column_list)]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span><span class="op">-</span>statement;</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TABLES</span>; #gives <span class="kw">all</span> <span class="kw">the</span> <span class="kw">tables</span> <span class="kw">and</span> viwes since <span class="kw">both</span> shred same nemespace</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FULL</span> <span class="kw">TABLES</span>; #To know which <span class="dt">object</span> <span class="kw">is</span> a <span class="kw">view</span> <span class="kw">or</span> <span class="kw">table</span></span></code></pre></div>
<ul>
<li>MySQL allows you to create a view based on another view.</li>
</ul>
</section>
<section id="view-processing-algorithms" class="level2">
<h2>View Processing Algorithms</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>#CREATE <span class="kw">VIEW</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> [<span class="kw">OR</span> <span class="kw">REPLACE</span>][ALGORITHM <span class="op">=</span> {<span class="kw">MERGE</span> | TEMPTABLE | UNDEFINED}] <span class="kw">VIEW</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>   view_name[(column_list)]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">select</span><span class="op">-</span>statement;</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>#ALTER <span class="kw">VIEW</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> [ALGORITHM <span class="op">=</span> {<span class="kw">MERGE</span> | TEMPTABLE | UNDEFINED}] <span class="kw">VIEW</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>   view_name[(column_list)] </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>   <span class="kw">select</span><span class="op">-</span>statement;</span></code></pre></div>
</section>
<section id="updatable-views" class="level2">
<h2>Updatable views</h2>
<ul>
<li>In MySQL, views are not only queryable but also updatable. (INSERT | UPDATE | DELETE)</li>
<li>These modify rows of the base table through the updatable view.</li>
<li>However, to create an updatable view, the SELECT statement defining the view must not contain any of the following elements:</li>
</ul>
<pre><code>Aggregate functions such as MIN, MAX, SUM, AVG, and COUNT.
DISTINCT
GROUP BY clause.
HAVING clause.
UNION or UNION ALL clause.
Left join or outer join.
Subquery in the SELECT clause or in the WHERE clause that refers to the table appeared in the FROM clause.
Reference non-updatable views in the FROM clause.
Use literal values.
Multiple references to any column of the base table.</code></pre>
<ul>
<li>If you create a view with the TEMPTABLE algorithm, the view is not updatable.</li>
<li>Note that it is possible to create updatable views based on multiple tables using an inner join.</li>
</ul>
</section>
<section id="with-check-option" class="level2">
<h2>WITH CHECK OPTION</h2>
<ul>
<li><p>Sometimes, you create a view to reveal the partial data of a table. However, a simple view is updatable, and therefore, it is possible to update data that is not visible through the view. This update makes the view inconsistent.</p></li>
<li><p>To ensure the consistency of the view, you use the WITH CHECK OPTION clause when you create or modify the view.</p></li>
<li><p>The WITH CHECK OPTION is an optional clause of the CREATE VIEW statement. This WITH CHECK OPTION prevents you from updating or inserting rows that are not visible through the view.</p></li>
<li><p>In other words, whenever you update or insert a row of the base tables through a view, MySQL ensures that the insert or update operation conforms with the definition of the view.</p></li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">VIEW</span> view_name </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  select_statement</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> <span class="kw">CHECK</span> <span class="kw">OPTION</span>;</span></code></pre></div>
</section>
<section id="show-view" class="level2">
<h2>Show View</h2>
<ul>
<li>Note that the SHOW TABLES statement returns only the views that you have the privilege to access.</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FULL</span> <span class="kw">TABLES</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>[{<span class="kw">FROM</span> | <span class="kw">IN</span> } database_name]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> table_type <span class="op">=</span> <span class="st">&#39;VIEW&#39;</span>;</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">FULL</span> <span class="kw">TABLES</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>[{<span class="kw">FROM</span> | <span class="kw">IN</span> } database_name]</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="kw">LIKE</span> pattern;</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>#Query <span class="kw">data</span> <span class="kw">from</span> <span class="kw">the</span> <span class="kw">table</span> information_schema.<span class="kw">tables</span> <span class="kw">to</span> get <span class="kw">the</span> views <span class="kw">in</span> a <span class="kw">database</span>.</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> information_schema.<span class="kw">tables</span>; </span></code></pre></div>
</section>
<section id="show-create-view" class="level2">
<h2>SHOW CREATE VIEW</h2>
<ul>
<li>Use the SHOW CREATE VIEW statement to display the statement used to create the view.</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">CREATE</span> <span class="kw">VIEW</span> view_name;</span></code></pre></div>
</section>
<section id="rename-view" class="level2">
<h2>Rename View</h2>
<div class="sourceCode" id="cb42"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">RENAME</span> <span class="kw">TABLE</span> original_view_name <span class="kw">TO</span> new_view_name;</span></code></pre></div>
<ul>
<li>Another indirect way to rename a view is to use a sequence of the DROP VIEW and CREATE VIEW statement.</li>
</ul>
</section>
<section id="drop-view" class="level2">
<h2>DROP VIEW</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">VIEW</span> [<span class="cf">IF</span> <span class="kw">EXISTS</span>] view_name1 [,view_name2]<span class="op">..</span>.;</span></code></pre></div>
</section>
</section>
</body>
</html>
